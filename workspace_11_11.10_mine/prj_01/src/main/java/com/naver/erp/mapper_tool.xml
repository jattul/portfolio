<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.naver.erp.ToolDAO">


<select id="getToolList"  parameterType="com.naver.erp.ToolDTO" resultType="java.util.HashMap">
select * from ( select rownum RNUM, zxcvb. * from (
	SELECT no       		 as "no"     
	,name        			 as "name"  
	,brand          			 as "brand" 
	,bigsortno 					as "bigsortno"
	,smallsortno        		 as "smallsortno"  
	,(SELECT NAME FROM JIJUM WHERE NO = t.jijumno)    		 as "jijumname"  
	,jijumno    			 as "jijumno"  
	,nowstatus 		 as "nowstatus"   
FROM TOOL t

  	where 1=1 
	
	<if test="keyword!=null and keyword.length()>0">
		and t.name like '%${keyword}%'
	</if>
	<if test="jijumname!=null and jijumname.length()>0">
		and jijumno = ${jijumname}										
	</if>
	<if test="smallsortno!=null and smallsortno.length()>0">
		and smallsortno = ${smallsortno}										
	</if>
	<if test="keywordtype!=null and keywordtype.length()>0">
		and nowstatus = ${keywordtype}										
	</if>
	<if test="sort==null or sort.length()==0" >
                        order by
                           no desc
    </if>
    <if test="sort!=null and sort.length()>0" >
                        order by ${sort}
    </if>
    
<![CDATA[
	) zxcvb) where RNUM >= #{begin_rowNo} and RNUM <= #{end_rowNo}
]]>

</select>

<select id="getsmallList"  parameterType="com.naver.erp.ToolDTO" resultType="java.util.HashMap">
	select no as "sno" 
		   ,name as "sname"
      from smallSort

</select>

<select id="getJijumList"  parameterType="com.naver.erp.ToolDTO" resultType="java.util.HashMap">
	select no as "jijumno" 
		   ,name as "jijumname"
      from jijum

</select>


<select id="toolListTotCnt" parameterType="com.naver.erp.ToolDTO" resultType="int">
	select COUNT(*) from tool where 1=1 

	<if test="keyword!=null and keyword!=''">
		and	        (
								upper(name) like upper('%${keyword}%')
	</if>
	<if test="keyword!=null and keyword!=''">
		or
								upper(brand) like upper('%${keyword}%')
					)
	</if>
	
</select>


<select id="getToolDetailFromTool" parameterType="int"	resultType="java.util.HashMap">
	select * from tool where no=#{no}
	
</select>

<select id="getToolDetailFromJijum" parameterType="int" resultType="java.util.HashMap">
	select * from jijum where no=#{no}

</select>

<update id="upToolStatus" parameterType="int">
	 	update 
			tool
		set
			nowstatus = 1
		 where no = #{no}
</update>
	
<insert id="insertToolRentBooktoOnBooking" parameterType="java.util.HashMap" >
		insert  into onBooking
		values(
		(select nvl(max(no),0)+1 from onBooking)
		,(select no from memberBoard where email=#{email})
		,#{memberemail}
		,sysdate
		,#{no}
		,#{jijumno}
		,#{toolname}
		)
		
</insert>
  
</mapper>